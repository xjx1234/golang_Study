# 5. GO语言结构体与面向对象

Go 语言通过用自定义的方式形成新的类型，结构体是类型中带有成员的复合类型。Go 语言使用结构体和结构体成员来描述实体和实体对应的各种属性。



结构体成员是由一系列的成员变量构成，这些成员变量也被称为“字段”。字段有以下特性：

- 字段拥有自己的类型和值。
- 字段名必须唯一。
- 字段的类型也可以是结构体，甚至是字段所在结构体的类型。

Go 语言中没有“类”的概念，也不支持“类”的继承等面向对象的概念。

Go 语言的结构体与“类”都是复合结构体，但 Go 语言中结构体的内嵌配合接口比面向对象具有更高的扩展性和灵活性。

Go 语言不仅认为结构体能拥有方法，且每种自定义类型也可以拥有自己的方法。



## 5.1 结构体定义与初始化



### 5.1.1 结构体定义

使用关键字 **type** 可以将各种基本类型定义为自定义类型，基本类型包括整型、字符串、布尔等。结构体是一种复合的基本类型，通过 type 定义为自定义类型后，使结构体更便于使用。

结构体的定义格式如下：

```
type 结构体名 struct {
    字段1 类型
    字段2 类型
    …
}
```

示例：

```go
//定义书本结构体
type Book struct {
	title string
	author string
	id int
	page int
}
```

如上示例，定义了一个 Book结构体，结构体包括 title author id page四个属性。结构体的定义只是一种内存布局的描述，只有当结构体实例化时，才会真正地分配内存。

### 5.1.2 结构体实例化与初始化

结构体的实例化跟变量实例化差不多，基本格式如下：

`var 结构体实例名称 结构体名称`

示例：

```go
package main

//定义书本结构体
type Book struct {
	title string
	author string
	id int
	page int
}

func main() {
	//实例化结构体
	var myBook Book

	//给结构体成员变量赋值
	myBook.title = "go语言学习"
	myBook.author = "xjx"
	myBook.id = 1
	myBook.page = 357
}
```

例子中，使用`.`来访问结构体的成员变量，如`myBook.title和 myBook.author`等，结构体成员变量的赋值方法与普通变量一致。

除了直接实例化结构体外，还可以通过 `new` 或者 `&` 来直接对结构体进行实例化，以便获取指针类型的结构图，示例：

```go
package main

//定义书本结构体
type Book struct {
	title string
	author string
	id int
	page int
}

func main() {
	//使用 & 实例化结构体
	myBook := &Book{}
	myBook.title = "go语言学习"
	myBook.author = "xjx"
	myBook.id = 1
	myBook.page = 357

	//使用 new 实例化结构体
	myBook2 := new(Book)
	myBook2.title = "go语言训练"
	myBook2.author = "xjx"
	myBook2.id = 2
	myBook2.page = 400
}
```



结构体也可以使用“键值对”（Key value pair）初始化字段，每个“键”（Key）对应结构体中的一个字段，键的“值”（Value）对应字段需要初始化的值。键值对初始化的格式如下：

```
ins := 结构体类型名{
    字段1: 值,
    字段2: 值,
    …
}
或者 
ins := 结构体类型名{
    字段1值,
    字段2值,
    …
}
```

代码示例：

```go
import "fmt"

//定义书本结构体
type Book struct {
	title  string
	author string
	id     int
	page   int
}

func main() {
	//初始化化结构体
	myBook := Book{
		"go语言",
		"xjx",
		1,
		22,
	}

	//初始化化结构体
	myBook2 := Book{
		title:  "go语言2",
		author: "xjx",
		id:     2,
		page:   333,
	}
	fmt.Println(myBook)
	fmt.Println(myBook2)
}
```

上述代码中，一种是忽略键值，直接给出初始化值，另外一种是带上键和值，初始化值。

使用其中忽略键的方式这种格式初始化时，需要注意：

- 必须初始化结构体的所有字段。
- 每一个初始值的填充顺序必须与字段在结构体中的声明顺序一致。
- 键值对与值列表的初始化形式不能混用。

而带键值得方式则不需要按此规则操作。

### 5.1.3 匿名结构体

匿名结构体没有类型名称，无须通过 type 关键字定义就可以直接使用。

匿名结构体定义格式：

```
变量名 := struct {
    // 匿名结构体字段定义
    字段1 字段类型1
    字段2 字段类型2
    …
}{
    // 字段值初始化
    初始化字段1: 字段1的值,
    初始化字段2: 字段2的值,
    …
}
```

代码如下：

```go

package main

import "fmt"

//接收匿名结构体，打印匿名结构体信息
func printBookInfo(bookinfo *struct {
	id    int
	title string
}) {
	fmt.Println(bookinfo.id, bookinfo.title)
}

func main() {
	//定义匿名结构体
	book := &struct {
		id    int
		title string
	}{
		1, "xxxxx",
	}
	printBookInfo(book)
}
```



## 5.2 方法与接收者

接收者类型可以是（几乎）任何类型，不仅仅是结构体类型，任何类型都可以有方法，甚至可以是函数类型，可以是 int、bool、string 或数组的别名类型，但是接收者不能是一个接口类型，因为接口是一个抽象定义，而方法却是具体实现，如果这样做了就会引发一个编译错误`invalid receiver type…`。

接收者也不能是一个指针类型，但是它可以是任何其他允许类型的指针，一个类型加上它的方法等价于面向对象中的一个类，一个重要的区别是，在Go语言中，类型的代码和绑定在它上面的方法的代码可以不放置在一起，它们可以存在不同的源文件中，唯一的要求是它们必须是同一个包的。

接收器的格式如下：

```
func (接收者变量 接收者类型) 方法名(参数列表) (返回参数) {
    函数体
}
```

