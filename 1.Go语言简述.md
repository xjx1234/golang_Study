# 1.  Go语言简述



## 1.1 环境变量与工程结构

安装好Go程序后，在开始写程序前，我们需要对Go的环境变量以及工程目录结构有一定的了解，这样会帮助我们明了以及梳理Go的一些运行目录以及文件依赖下载目录。

其中`GOROOT` `GOPATH`  这二个环境变量的概念以及目录结构尤其重要，我们在命令行模式下输入: `go env` 命令，就可以得到环境变量的值，如下图：

<img src="https://my-data-structure.oss-cn-shanghai.aliyuncs.com/resume_golang/1.1.1.png" style="zoom: 80%;" />



- **GOARCH**   目标处理器架构

- **GOBIN**   编译器和链接器安装位置

- **GOOS**   目标操作系统

- **GOROOT**  

  Go语言安装根目录，也是Go的安装路径；

  Windows系统默认安装为：`C:/go` 目录， Linux系统则一般会为： `/usr/local/go` 目录;  

  在GOROOT所在目录下，会有下列子目录，其作用分别如下表：

  | 目录名 |                             说明                             |
  | :----: | :----------------------------------------------------------: |
  |  api   |                  存放每个版本的api变更差异                   |
  |  bin   | 存放所有有官方提供的go语言相关工具的可执行文件，默认情况下，该目录包含go和gofmt这两个工具 |
  |  pkg   | 存放Go语言标准库的所有归档文件；<br>（1）pkg文件夹包含一个与Go安装平台相关的子目录，我们称之为“平台相关目录”。例如，在针对Linux 32bit操作系统的二进制安装包中，平台相关目录的名字就是linux_386；而在针对Windows 64bit操作系统的安装包中，平台相关目录的名字则为windows_amd64。<br>（2）Go源码文件对应于以“.a”为结尾的归档文件，它们就存储在pkg文件夹下的平台相关目录中 <br>(3) pkg文件夹下有一个名叫tool的子文件夹，该子文件夹下也有一个平台相关目录，其中存放了很多可执行文件 |
  |  lib   |                       引用的一些库文件                       |
  |  src   | 存放所有标准库、Go语言工具，以及相关底层库（C语言实现）的源码 |
  |  doc   |                       英文版的 Go 文档                       |
  |  misc  |  杂项用途的文件，例如 [Android]平台的编译、git 的提交钩子等  |
  |  test  |                 存放测试Go语言自身代码的文件                 |

  

- **GOPATH**

  Go语言中跟工作空间相关的环境变量，这个变量指定Go语言的工作空间位置。 <font color="#dd0000">**直白的说就是你程序开发的主要目录**</font>。

  假如执行 `go env` 命令查看 GOPATH出现 `-bash: go: command not found`或者GOPATH值为空，则需要对GOPATH进行设置，方法如下：

  - Windows系统下，右键点击 `我的电脑`，选择 `属性` -> `高级系统设置` -> `环境变量(N)`; 在弹出的菜单中添加 变量名为 GOPATH，变量值为你需要开发程序的目录，例如：D:\Go即可，保存后完成。
  - Linux系统下，执行 `vim /etc/profile` 命令，在文件尾部添加 `export GOPATH=/root/go` (/root/go为演示路径, 用户可自行定义理想路径)和 export PATH=$PATH:$GOPATH/bin` 即可，然后执行 `source /etc/profile` 完成操作。
  - Mac系统下，执行 `vi ~/.bash_profile`， 在文件尾部加上 `export GOPATH=$HOME/go`($Home/go为演示路径, 用户可自行定义理想路径)，最后执行 `source ~/.bash_profile` 即可。

  需要注意的是 <font color="#dd0000">**GOPATH目录可以设置多个目录**</font>，例如Linux下 ``export GOPATH=/root/go:/root/go2``,  Windows下则直接设置变量名为 GOPATH的值为 `C:/go;D:/go`(演示假设目录)。

  

在GOPATH所在目录下，也会几个重要的子目录，其作用分别如下表：

| 目录名  |                             说明                             |
| :-----: | :----------------------------------------------------------: |
| **src** | 用于以代码包的形式组织并保存Go源码文件，这里的代码包，与src下的子目录一一对应。<br>**<font color="#dd0000">这里指的代码包即项目代码包以及项目所依赖的第三方包</font>** <br />例如，若一个源码文件被声明为属于代码包logging，那么它就应当被保存在src目录下名为logging的子目录中。当然，我们也可以把Go源码文件直接放于src目录下，但这样的Go源码文件就只能被声明为属于main代码包了。除非用于临时测试或演示，一般还是建议把Go源码文件放入特定的代码包中。 |
|   pkg   | 用于存放经由go install命令构建安装后的代码包（包含Go库源码文件）的“.a”归档文件。<br>该目录与GOROOT目录下的pkg功能类似。区别在于，工作区中的pkg目录专门用来存放用户（也就是程序开发者）代码的归档文件。构建和安装用户源码的过程一般会以代码包为单位进行，比如logging包被编译安装后，将生成一个名为logging.a的归档文件，并存放在当前工作区的pkg目录下的平台相关目录中。 |
|   bin   | 与pkg目录类似，在通过go install命令完成安装后，保存由Go命令源码文件生成的可执行文件。<br>在Linux操作系统下，这个可执行文件一般是一个与源码文件同名的文件。而在Windows操作系统下，这个可执行文件的名称是源码文件名称加.exe后缀。 |

GOPATH目录结构图如下图所示：

![](https://my-data-structure.oss-cn-shanghai.aliyuncs.com/resume_golang/1.1.2.jpg)





## 1.2 依赖管理

在GO语言 1.6 版本以前，所有Go项目都需要的依赖代码包都必须在同一个工作空间 : `$GOPATH/src` 内 ，比如：

```txt
src/
    github.com/golang/example/
        .git/                      # Git repository metadata
    outyet/
        main.go                # command source
        main_test.go           # test source
    stringutil/
        reverse.go             # package source
        reverse_test.go        # test source
```

这样就导致了Go里面没有 npm 之类的包管理工具，只有通过 `go get ` 命令从支持的代码托管平台下载依赖，这样做会产生很多问题，比如同一个包只能保存一个版本的代码，如果你变更版本就只能重新下载。然后将原来包覆盖掉，操作起来会非常麻烦。为了解决这个问题，Go 1.6 版本将 `vender`目录被添加到除`GOPATH`和`GOROOT`之外的依赖目录，如果项目目录下有 vendor 目录，那么Go语言编译器会优先使用 vendor 内的包进行编译、测试等。当然也可以使用 godep 或者 dep 等管理工具来对vendor目录进行有效管理。

介绍完Go依赖包管理的发展历程后，来重点讲下另外一个包依赖管理工具  **go module** ,  Go语言从 1.11 版本之后官方推出的该版本管理工具，并且从 Go1.13 版本开始，go module 成为了Go语言默认的依赖管理工具。 

`go env` 获取环境变量后，有一个环境变量跟go module  状态息息相关，这个变量就是 ： **GO111MODULE** ， 要启用go module支持首先要设置环境变量`GO111MODULE`，通过它可以开启或关闭模块支持，它有三个可选值：`off`、`on`、`auto`，默认值是`auto`。

MacOS 或者 Linux 下临时开启 GO111MODULE 的命令为：

> ```
> export GO111MODULE=on
> ```


全局开启 GO111MODULE 的命令为：

> ```
> go env -w GO111MODULE=on
> ```

GO111MODULE  开启后，我们需要对 **GOPROXY**进行设置，**GOPROXY**顾名思义就是代理服务器的意思。大家都知道，国内的网络有防火墙的存在，这导致有些Go语言的第三方包我们无法直接通过`go get `命令获取。GOPROXY 是Go语言官方提供的一种通过中间代理商来为用户提供包下载服务的方式。要使用 GOPROXY 只需要设置环境变量 GOPROXY 即可，Go1.13之后`GOPROXY`默认值为`https://proxy.golang.org`。

目前国内较好公开的代理服务器的地址有：

- 阿里： https://mirrors.aliyun.com/goproxy/
- 七牛：https://goproxy.cn/

GOPROXY 设置命令为：

> ```
> go env -w GOPROXY=https://mirrors.aliyun.com/goproxy/,direct
> ```

在开启了 GO111MODULE   以及设置了 GOPROXY后就可以使用 go module 工具了，也就是说**<font color="#D2691E">在以后的开发中就没有必要在 GOPATH 中创建项目了</font>**，并且还能够很好的管理项目依赖的第三方包信息。

假如我们在 /root/go2/src/main 目录下，存放一个 main.go程序，代码如下：

```go
package main

import (
    "fmt"
    "github.com/labstack/echo"
)

func main(){
    e := echo.New()
    fmt.Println(e.Start(":1323"))
}
```

然后

在main目录下使用 go module 的`go mod init `命令后会在当前执行目录下生成一个 go. mod 文件，

在运行/编译程序或者使用 `go get` 等 命令时，会在当前目录下生成go.sum文件。**<font color="#dd0000">这里需要说明一点的是，执行 `go run | go build | go install`等运行编译程序指令时，go mod 会自动下载依赖库到  GOPATH/pkg/mod 目录下，而不是GOPATH/src目录下</font>**（编译运行相关命令，会具体在 1.4 介绍）

命令执行后的目录结构如下所示：

```txt
[root@instance-vqcz8mru main]# ls
go.mod  go.sum  main.go
```

go.mod 文件记录了项目所有的依赖信息，其结构大致如下：

```txt
module main

go 1.15

require (
	github.com/labstack/echo v3.3.10+incompatible // indirect
	github.com/labstack/gommon v0.3.0 // indirect
	golang.org/x/crypto v0.0.0-20201221181555-eec23a3978ad // indirect
)

```

其中，module 为 go.mod 文件所属的包，require 为项目所依赖的包及版本号，indirect 表示间接引用。

go.sum 文件则是用来记录每个依赖包的版本及哈希值，如下所示 :

```txt
github.com/davecgh/go-spew v1.1.0/go.mod h1:J7Y8YcW2NihsgmVo/mv3lAwl/skON4iLHjSsI+c5H38=
.................
gopkg.in/check.v1 v0.0.0-20161208181325-20d25e280405/go.mod h1:Co6ibVJAznAaIkqp8huTwlJQCZ016jof/cbN4VW5Yz0=
gopkg.in/yaml.v2 v2.2.2/go.mod h1:hI93XBmqTisBFMUTm0b8Fm+jr3Dg1NNxqwp+5A1VGuI=

```

GO111MODULE 除了 `go mod init` 命令外，还有一些其他命令也可以了解下：

|      命令       |                      说明                      |
| :-------------: | :--------------------------------------------: |
|   go mod init   |       初始化当前文件夹，创建 go.mod 文件       |
|   go mod edit   |                编辑 go.mod 文件                |
| go mod download | 下载依赖包到本地（默认为 GOPATH/pkg/mod 目录） |
|   go mod tidy   |           增加缺少的包，删除无用的包           |
|  go mod verify  |                    校验依赖                    |
|   go mod why    |               解释为什么需要依赖               |
|  go mod graph   |                 打印模块依赖图                 |
|  go mod vendor  |           将依赖复制到 vendor 目录下           |



## 1.3  第一个Go程序





## 1.4 编译与运行